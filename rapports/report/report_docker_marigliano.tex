% inspired from: https://github.com/SnipyJulmy/hesso-latextemplate-lab
\documentclass[11pt,a4paper,oneside]{report}
\usepackage[margin=2cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{minted}
\usepackage{titlesec}
\usepackage[pdftex]{graphicx} % graphics importing
\usepackage{titling} % can use \theauthor \thetitle
\usepackage{parskip} % remove first line indenting in a section
\usepackage{microtype} % typographic improvements
\usepackage[defaultlines=3,all]{nowidow}
\usepackage[toc,page]{appendix}
\usepackage{verbatim}
\usepackage{float}
\usepackage{enumerate}

% == Header and Footer
\usepackage{fancyhdr}

% style for all normal pages
\fancypagestyle{normal}{
\fancyhf{}
\setlength\headheight{14pt}
\lhead[]{Docker and Embedded systems}
\chead[]{}
\rhead{\includegraphics[width=3cm]{img/mse_logo}}
\lfoot[]{}
\cfoot[]{\thepage}
\rfoot[]{}
\renewcommand{\headrulewidth}{0.4pt}% Default \headrulewidth is 0.4pt
\renewcommand{\footrulewidth}{0.4pt}% default is 0pt
}

% style for history
\fancypagestyle{historystyle}{
\setlength\headheight{14pt}
\lhead[]{Docker and Embedded systems}
\chead[]{}
\rhead{\includegraphics[width=3cm]{img/mse_logo}}
\lfoot[]{}
\cfoot[]{}
\rfoot[]{}

\renewcommand{\headrulewidth}{0.4pt}% Default \headrulewidth is 0.4pt
\renewcommand{\footrulewidth}{0pt}
}

\usepackage[hyphens]{url} % line wrap urls
\usepackage{hyperref}

% == Version history
\usepackage{vhistory}


% == Code snippets
\newminted{bash}{xleftmargin=20pt, linenos=true, breaklines=true, frame=single, framesep=6pt, tabsize=2, fontfamily=courier, fontsize=\small}

% inline code
\newcommand{\code}[1]{\texttt{#1}}

% == Chapter titles
% Remove space before title
\titlespacing{\chapter}{0pt}{*-4}{*3}
% Remove "Chapter N" and use a sans-serif font
\titleformat{\chapter}{\normalfont\huge}{\thechapter.}{20pt}{\huge}
% Change chapter page style
\patchcmd{\chapter}{plain}{fancy}{}{}



% Metadata
\newcommand{\school}{Haute École d'ingénierie et d'architecture de Fribourg}
\newcommand{\oldreportname}{État de l’art à la mi-projet de semestre Docker and embedded systems - Ou comment ne pas cross compiler Docker sur ARM}

\title{Projet de semestre Docker and embedded systems}
\author{Gary \bsc{Marigliano}}

% aliases
\newcommand{\odroid}{ODROID-XU3 Lite }

\begin{document}

\begin{titlepage}
\begin{center}

\includegraphics[width=0.6\textwidth]{img/docker_logo}\\[1cm]

\begin{figure}[htbp]
\begin{minipage}[c]{.45\linewidth}
\begin{flushleft}
\includegraphics[width=7cm]{img/mse_logo}
\end{flushleft}
\end{minipage}
\hfill
\begin{minipage}[c]{.45\linewidth}
\begin{flushright}
\includegraphics[height=2cm]{img/logo_hes-so}
\end{flushright}
\end{minipage}
\end{figure}

% Title
\rule{\linewidth}{0.5mm} \\[0.4cm]
{ \huge \bfseries \thetitle \\[0.4cm] }
\rule{\linewidth}{0.5mm} \\[1.5cm]

% Author and supervisor
\noindent
\begin{minipage}{0.4\textwidth}
  \begin{flushleft} \large
    \emph{Auteur :}\\
    \theauthor
  \end{flushleft}
\end{minipage}%
\begin{minipage}{0.4\textwidth}
  \begin{flushright} \large
    \emph{Encadrant :} \\
    Jean-Roland \bsc{Schüler}
  \end{flushright}
\end{minipage}

\vfill

\noindent
\begin{minipage}{0.4\textwidth}
  \begin{flushleft} \large
    \emph{Contact :}\\
    gary.marigliano@master.hes-so.ch
  \end{flushleft}
\end{minipage}%
\begin{minipage}{0.4\textwidth}
  \begin{flushright} \large
    \emph{Mandant :} \\
    \school
  \end{flushright}
\end{minipage}

\vfill

% Bottom of the page
{\large Version 0.0.1 \\ \today}

\end{center}
\end{titlepage}

\pagestyle{historystyle}
\begin{versionhistory}  
  \vhEntry{0.0.1}{02.05.16}{\theauthor}{Création du document}
\end{versionhistory}


\chapter{Résumé du document}

TODO

\pagenumbering{gobble}
\tableofcontents
\pagenumbering{arabic}

\pagestyle{normal}

\chapter{Introduction}

\section{Contexte}\label{contexte}

Ce document est le rapport de fin de projet de semestre Docker and embedded systems. Un des buts de ce projet est de cross compiler Docker à partir de ses sources pour produire un binaire exécutable sur un \odroid (ARMv7). De plus, une partie concernant la sécurité de Docker est également traitée.

Lien: \url{https://github.com/krypty/docker_and_embedded_systems}

Ce projet de semestre s'inscrit dans une certaine continuité avec les projets de semestre et de bachelor de M. Loic Bassang \cite{TODO}. Plusieurs pistes intéressantes avaient en effet été mentionnées dans ces projets là notamment une partie concernant la sécurité et Docker. Ainsi, ce rapport fera parfois des parallèles avec ces documents.

Il est important de noter que la vitesse de développement de Docker est assez hallucinante. En effet, sur Github (\url{https://github.com/docker/docker}) les commits se succèdent à vitesse grand V. Entre chaque version de Docker qui sortent environ tous les mois, il est courant d'avoir plus de 3000 commits qui ont été \emph{pushés}. Tout ceci pour dire qu'à la lecture de ce document, il est quasiment sûr que certaines pistes explorées soient définitivement obsolètes ou au contraire deviennent la voie à suivre du à une mise à jour quelconque.


\section{Objectifs}

De manière plus précise, ce projet vise à maitriser les parties suivantes:

\begin{enumerate}
  \item Construction d'un système Linux capable de faire tourner Docker et son \emph{daemon} en utilisant Buildroot. Pour générer le dit système, on dispose d'un \emph{repository} Gitlab hébergé à la \school

  \item Cross compilation de Docker et de son \emph{daemon}, capable de faire tourner des containers
  
  \item Comprendre, analyser et évaluer l'aspect sécurité de Docker dans le cadre d'une utilisation avec une carte embarquée
\end{enumerate}

Les deux premiers points ont été traités dans un précédent rapport appelé "\oldreportname".

Ce document se concentre, dès lors, sur le dernier point ainsi que sur le déroulement global du projet.


\chapter{Présentation de Docker}

\textbf{Remarque : } Si le lecteur a déjà lu le rapport "\oldreportname", il ne lui est pas nécessaire de relire ce chapitre sachant qu'il s'agit du même contenu.

\input{../presentation-docker}

\chapter{Matériel utilisé et mise en place de la cible}

Ce chapitre présente le matériel utilisé dans le projet ainsi que son installation et sa configuration de base.

Afin de réaliser ce projet, une carte embarquée \odroid a été mise à disposition afin d'y faire tourner Docker. 

\section{La carte \odroid}

Cette carte possède les caractéristiques suivantes \cite{TODO}: 

\begin{itemize}
\item Samsung Exynos5422 Cortex™-A15 1.8Ghz quad core and Cortex™-A7 quad core CPUs 
\item Mali-T628 MP6(OpenGL ES 3.0/2.0/1.1 and OpenCL 1.1 Full profile)
\item 2Gbyte LPDDR3 RAM at 933MHz (14.9GB/s memory bandwidth) PoP stacked
\item eMMC5.0 HS400 Flash Storage
\item USB 3.0 Host x 1, USB 3.0 OTG x 1, USB 2.0 Host x 4
\item HDMI 1.4a for display
\end{itemize}

\begin{figure}[hbtp]
\centering
\includegraphics[scale=0.5]{img/ODROIDXU3Lite.jpg}
\caption{\odroid}
\end{figure}

\section{Installation}

Initialement, il était prévu de générer un système d'exploitation minimal qui aurait été capable de faire tourner Docker et des containers. Malheureusement, il n'a pas été possible de cross compiler Docker \textit{et son daemon} afin de lancer des containers sur ce système minimal. Plus d'informations sont disponibles dans le rapport \oldreportname. 

Ainsi, il a été décidé, de la même manière que pour le travail de bachelor précédent, d'utiliser une distribution GNU/Linux proposant Docker dans ses packages. Le choix s'est donc porté sur \textbf{Archlinux ARM} \cite{TODO}.

Sur la page wiki de la distribution (\url{https://archlinuxarm.org/platforms/armv7/samsung/odroid-xu3}), on peut suivre un guide de génération de la carte SD qui contient le système d'exploitation. Ce guide est disponible à l'appendice \ref{install_alarm_odroid}.

\chapter{Objectif 3 - TODO}

\section{Situation actuelle}
TODO: rappeler les objectifs, en particulier l'objectif courant (le 3)...

TODO: dire qu'on part d'une distribution Archlinux ARM et qu'on utilise un Odroid XU3 car pas réussi à cross compiler Docker. Tout comme cela avait été fait pour le travail de Bachelor précédent.


\section{Structure de la suite du document}

Pour ce projet, il a été décidé d'étudier la question de la sécurité avec Docker avec une approche en couches. A peu à la manière du modèle OSI\footnote{Modèle OSI: \url{https://fr.wikipedia.org/wiki/Mod\%C3\%A8le_OSI}} en réseau, chaque couche représente un ensemble de fonctionnalités qui, dans le cas de ce projet, doit faire l'objet d'une évaluation de la sécurité.

L'étude de la sécurité de Docker a donc été séparée avec les couches arbitraires suivantes:

\begin{itemize}

\item Compilation et installation de Docker : en particulier les options  de compilation

\item \nameref{config_systeme_os_hote} : configuration du kernel, configuration des options de lancement de Docker, etc.

\item \nameref{creation_utilisation_images_docker} : Bonnes pratiques et contraintes liées au monde de l'embarqué

\item \nameref{utilisation_containers}

\end{itemize}

\textbf{Remarque : } Chacune de ces couches fait l'objet d'un chapitre dans ce rapport excepté le premier point : Compilation et installation de Docker. En effet, celui-ci n'est pas traité car, comme annoncé précédemment, la cross compilation de Docker sur un système ARM n'a pas aboutie. L'effort est alors concentré sur les autres points.


\chapter{Configuration du système d'exploitation hôte}\label{config_systeme_os_hote}

TODO TODO TODO TODO TODO TODO TODO TODO TODO 
Dans ce chapitre, on présente diverses bonnes pratiques et configurations dans le but de sécuriser Docker et/ou le système l'hébergeant.

Parmi ces techniques, on peut citer :

\begin{itemize}
\item TODOchaptertitle
\item TODO
\end{itemize}

\section{Passage en revue du benchmark de sécurité : CIS Docker 1.11.0 Benchmark}

TODO décrire ce que c'est ce bench, énumerer les points testés et en explorer un certain nombre

\subsection{Ne pas utiliser AUFS}

TODO

\subsection{User namespace}

TODO

\subsection{Interdiction de la communication réseau entre containers}

TODO

\section{Séparation des données Docker dans une partition chiffrée}

TODO

\section{TODO}

TODO

\chapter{Création et utilisation des images Docker}\label{creation_utilisation_images_docker}

TODO

\chapter{Utilisation des containers}\label{utilisation_containers}

TODO

\chapter{Déroulement du projet}

\section{Planning initial}

TODO

\section{Planning final}

TODO

\chapter{Proposition d'améliorations vis à vis du travail précédent}

TODO: passer en revue et critique positivement le travail de Bachelor précédent. Dire que ce n'est pas une critique négative mais apporter un avis supplémentaire et plus récent (Docker évoluant beaucoup)
% == Bibliography
\nocite{*} % cite all
\bibliographystyle{plain}
\bibliography{bibliography}

\begin{appendices}
\chapter{Installation de Archlinux ARM sur \odroid}\label{install_alarm_odroid}

\textbf{Remarque : }Ce guide requiert l'utilisation d'un ordinateur sous GNU/Linux.

Source : \url{https://archlinuxarm.org/platforms/armv7/samsung/odroid-xu3}

\input{appendices/archlinux_arm_odroid_xu3_install}

\end{appendices}

\end{document}
